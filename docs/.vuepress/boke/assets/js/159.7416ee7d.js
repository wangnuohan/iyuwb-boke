(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{589:function(e,t,a){"use strict";a.r(t);var s=a(53),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"v8-compile-cache"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#v8-compile-cache"}},[e._v("#")]),e._v(" v8-compile-cache")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://travis-ci.org/zertosh/v8-compile-cache",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://travis-ci.org/zertosh/v8-compile-cache.svg?branch=master",alt:"Build Status"}}),a("OutboundLink")],1)]),e._v(" "),a("p",[a("code",[e._v("v8-compile-cache")]),e._v(" attaches a "),a("code",[e._v("require")]),e._v(" hook to use "),a("a",{attrs:{href:"https://v8project.blogspot.com/2015/07/code-caching.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("V8's code cache"),a("OutboundLink")],1),e._v(' to speed up instantiation time. The "code cache" is the work of parsing and compiling done by V8.')]),e._v(" "),a("p",[e._v("The ability to tap into V8 to produce/consume this cache was introduced in "),a("a",{attrs:{href:"https://nodejs.org/en/blog/release/v5.7.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node v5.7.0"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"usage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[e._v("#")]),e._v(" Usage")]),e._v(" "),a("ol",[a("li",[e._v("Add the dependency:")])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" --save v8-compile-cache\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Then, in your entry module add:")])]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'v8-compile-cache'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[a("strong",[e._v("Requiring "),a("code",[e._v("v8-compile-cache")]),e._v(" in Node <5.7.0 is a noop â€“ but you need at least Node 4.0.0 to support the ES2015 syntax used by "),a("code",[e._v("v8-compile-cache")]),e._v(".")])]),e._v(" "),a("h2",{attrs:{id:"options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#options"}},[e._v("#")]),e._v(" Options")]),e._v(" "),a("p",[e._v("Set the environment variable "),a("code",[e._v("DISABLE_V8_COMPILE_CACHE=1")]),e._v(" to disable the cache.")]),e._v(" "),a("p",[e._v("Cache directory is defined by environment variable "),a("code",[e._v("V8_COMPILE_CACHE_CACHE_DIR")]),e._v(" or defaults to "),a("code",[e._v("<os.tmpdir()>/v8-compile-cache-<V8_VERSION>")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"internals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#internals"}},[e._v("#")]),e._v(" Internals")]),e._v(" "),a("p",[e._v("Cache files are suffixed "),a("code",[e._v(".BLOB")]),e._v(" and "),a("code",[e._v(".MAP")]),e._v(" corresponding to the entry module that required "),a("code",[e._v("v8-compile-cache")]),e._v(". The cache is "),a("em",[e._v("entry module specific")]),e._v(" because it is faster to load the entire code cache into memory at once, than it is to read it from disk on a file-by-file basis.")]),e._v(" "),a("h2",{attrs:{id:"benchmarks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#benchmarks"}},[e._v("#")]),e._v(" Benchmarks")]),e._v(" "),a("p",[e._v("See https://github.com/zertosh/v8-compile-cache/tree/master/bench.")]),e._v(" "),a("p",[a("strong",[e._v("Load Times:")])]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Module")]),e._v(" "),a("th",{staticStyle:{"text-align":"right"}},[e._v("Without Cache")]),e._v(" "),a("th",{staticStyle:{"text-align":"right"}},[e._v("With Cache")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("babel-core")])]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[a("code",[e._v("218ms")])]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[a("code",[e._v("185ms")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("yarn")])]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[a("code",[e._v("153ms")])]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[a("code",[e._v("113ms")])])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("yarn")]),e._v(" (bundled)")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[a("code",[e._v("228ms")])]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[a("code",[e._v("105ms")])])])])]),e._v(" "),a("p",[a("em",[e._v("^ Includes the overhead of loading the cache itself.")])]),e._v(" "),a("h2",{attrs:{id:"acknowledgements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acknowledgements"}},[e._v("#")]),e._v(" Acknowledgements")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("FileSystemBlobStore")]),e._v(" and "),a("code",[e._v("NativeCompileCache")]),e._v(" are based on Atom's implementation of their v8 compile cache:\n"),a("ul",[a("li",[e._v("https://github.com/atom/atom/blob/b0d7a8a/src/file-system-blob-store.js")]),e._v(" "),a("li",[e._v("https://github.com/atom/atom/blob/b0d7a8a/src/native-compile-cache.js")])])]),e._v(" "),a("li",[a("code",[e._v("mkdirpSync")]),e._v(" is based on:\n"),a("ul",[a("li",[e._v("https://github.com/substack/node-mkdirp/blob/f2003bb/index.js#L55-L98")])])])])])}),[],!1,null,null,null);t.default=o.exports}}]);